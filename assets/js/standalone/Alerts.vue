<template>

    <transition name="alert">

        <div class="vlAlertWrapper" v-if="alerts.length" 
            :style="{'z-index': zIndex - 2 }">

            <vl-alert v-for="(alert, key) in alerts"
                :alert="alert" :key="key" />

        </div>
        
    </transition>
</template>

<script>
    export default {
        data(){
            return {
                alerts : [],
                zIndex: 1500,
                initialId: 0
            }
        },
        methods:{
            close(k){
                this.alerts.splice(k)
            },
            closeById(id){
                var indexWithId = _.findIndex(this.alerts, (alert) => alert.id == id)
                this.alerts.splice(indexWithId)
            },
            addAlert(message, alertClass){
                this.initialId += 1
                this.alerts.push({
                    message: message,
                    class: 'vlAlert '+ alertClass,
                    id: this.initialId
                })
                setTimeout(()=> this.closeById(this.initialId), 3000)
            }
        },
        mounted(){
            this.$modal.events.$on('showAlert', (message, alertClass) => {
                console.log(message, alertClass)
                this.addAlert(message, alertClass)
            })
        }
    }
</script>
